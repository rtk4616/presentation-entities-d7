<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Encapsulation, Inheritance, and Polymorphism - ActiveLAMP Drupal Development Agency</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">
		<link rel="stylesheet" href="css/custom.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body style="background-image: url(img/presentation-bg2.svg); background-size: cover">

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1 class="title-slide">Encapsulation, Inheritance, and Polymorphism</h1>
					<h3>using Drupal Entities</h3>
					<p>
						<small>Presented by <a href="http://twitter.com/tomfriedhof ">Tom Friedhof</a> </small>
					</p>
					<aside class="notes">
						Hello everyone, thanks for coming today to my session on Drupal Entities.
					</aside>
				</section>

				<section>
					<h1 style="text-align: left ">Tom Friedhof</h1>
					<div style="width: 25%; float: left;">
						<img src="img/tom-friedhof.jpg" class="no-border" />
					</div>
					<div style="width: 75%; float: left;">
						<ul>
							<li>Senior Software Engineer at <a href="http://activelamp.com">ActiveLAMP</a></li>
							<li><a href="http://twitter.com/tomfriedhof">@tomfriedhof</a></li>
							<li><a href="http://twitter.com/activelamp">@activelamp</a></li>
						</ul>
					</div>
					<aside class="notes">
						<ul>
							<li>we are a Los Angeles based Digital Agency,   </li>
							<li>Drupal is our platform of choice.</li>
							<li>Our agency has been working on the Drupal platform now for about a decade.  We've been part of the community for a while.</li>
						</ul>
					</aside>
				</section>

				<section>
					<h2>Subscribe to our YouTube Channel</h2>
					<p>http://youtube.com/activelamp</p>
					<img src="img/activelamp-youtube.jpg" class="no-border" style="width: 65%"/>

					<aside class="notes">
						<ul>
							<li>Go to our YouTube channel right now and subscribe</li>
							<li>Now go to all your social feeds and tell everyone to subscribe (just kidding) kind of.</li>
							<li>We are going to be publishing the 3 sessions that I'm giving this week on our channel</li>
						</ul>
					</aside>
				</section>

				<section>
					<h2>Who here is currently coding entities?</h2>
					<aside class="notes">
						- Start off by asking a really quick question
					</aside>
				</section>

				<section>
					<h2>What I'll be covering today</h2>
					<ul>
						<li>What is a Drupal entity?</li>
						<li>Why you should use them.</li>
					</ul>
					<br /><br />
					<h1 class="fragment">Less How, more Why? </h1>
					<aside class="notes">
						<ul>
							<li>This presentation will be more about the why, not the how.</li>
							<li>There a bunch of tutorials online for the how.</li>
							<li>However, I will share with you guys a Yeoman generator we created for coding new entities.</li>
						</ul>
					</aside>
				</section>

				<!-- Example of nested vertical slides -->
				<section>
					<section>
						<h1>Some Drupal History</h1>
					</section>
					<section>
						<img src="img/entitiy-inception.jpg" class="no-border" style="margin-top: -60px" />
						<a href="https://www.flickr.com/photos/40571214@N00/9667435812/" class="vertical-footnote">https://www.flickr.com/photos/40571214@N00/9667435812/</a>
					</section>
					<!--<section>-->
						<!--<img src="img/entitiy-inception-2.jpg" class="no-border" style="margin-top: -50px" />-->
						<!--<a href="https://www.flickr.com/photos/40571214@N00/9667435812/" class="vertical-footnote">https://www.flickr.com/photos/40571214@N00/9667435812/</a>-->
					<!--</section>-->
					<section>
						<h1>Everything was a node</h1>
						<aside class="notes">
							<ul>
								<li>I entered the scene around 4.6</li>
								<li>Back then there was something called Flexinode</li>
								<li>That eventually became CCK for 4.7, 5.x, 6.x</li>
								<li>Views module came out around the same time</li>
							</ul>
						</aside>
					</section>
					<section>
						<h1>Drupal Utopia</h1>
						<img src="img/shaq-kobe.jpg" class="no-border fragment" />
						<a class="vertical-footnote" href="http://www.foxsports.com/nba/story/shaquille-oneal-murder-kobe-bryant-los-angeles-lakers-feud-2003-04-gary-payton-karl-malone-052715">Photo Credit</a>
						<aside class="notes">
							- We had everything we needed to win Championships
						</aside>
					</section>
					<section>
						<h1>Drupal Utopia</h1>
						<h1>CCK + Views = FTW</h1>
						<aside class="notes">
							- With CCK and Views we can build anything.
						</aside>
					</section>
					<section>
						<h1>Everything was a node</h1>
						<img src="img/oprah.gif" class="no-border" style="width: 70%;" />
						<p>Users, Terms, Panels, Everything!</p>
						<aside class="notes">
							-  All sorts of CCK fields being published, and tons of modules were created that all were based on using Nodes as the primary source for data or content on a Drupal site.
						</aside>
					</section>
				</section>

				<section>
					<h1>Drupal 7</h1>
					<h2 class="fragment">Entity + Field API</h2>
					<aside class="notes">
						<ul>
							<li>after about 4 years of being in the CCK and Views Drupal utopia, a better way to manage data in Drupal was released.</li>
							<li>everything in Drupal that managed data became Entities, and all Entities became fieldable.</li>
						</ul>
					</aside>
				</section>

				<section>
					<section>
						<h1>Something was missing.</h1>
						<div class="fragment">
							<h2>Entity API module</h2>
							<p>https://www.drupal.org/project/entity</p>
						</div>
						<aside class="notes">
							<ul>
								<li>basically the stuff that didn't make it in to Drupal 7 core because of timing</li>
								<li>you need it to get the full benefit of Entities in Drupal 7</li>
								<li>gives you Views and Rules integration, and basic CRUD operations on your custom entities</li>
							</ul>
						</aside>
					</section>

					<section>
						<h2>Define your own PHP Class</h2>
						<p class="fragment">Real objects... no more stdClass()</p>
						<aside class="notes">
							<ul>
								<li>This did not ship with Drupal core</li>
								<li>This IMO is the try power of entities</li>
								<li>Why is this such a cool feature? real objects</li>
								<li>What do you get with real objects? The ability for Encapsulation</li>
							</ul>
						</aside>
					</section>
				</section>

				<section>
					<section>
						<h1>Encapsulation</h1>
						<aside class="notes">have one PHP class that defines all the methods and data that surround that single object in one PHP class.</aside>
					</section>

					<section>
						<h2>Entity Class</h2>
						<pre><code data-trim contenteditable>
/**
 * @file
 * Tournament match class.
 */
class TourneyMatchEntity extends TourneyEntity {
  ...
  /**
   * Get the winner of the match
   */
  public function getWinner() {
    if (is_null($this->matchWinner)) {
      $this->matchWinner = $this->determineWinner();
    }
    return $this->matchWinner;
  }
  ...
}
						</code></pre>
					</section>

					<section>
						<h2>Implementation code</h2>
						<pre><code data-trim contenteditable>
/**
 * Get the winner of the match
 */
$match = tourney_match_load(1);

/**
 * Call method directly on object.
 */
$winner = $match->getWinner();
						</code></pre>
						<aside class="notes">
							All the logic surrounding this data is one place.
						</aside>
					</section>
					<section>
						<h1>Encapsulation</h1>
						<ul>
							<li>A language mechanism for restricting access to some of the object's components</li>
							<li>A language construct that facilitates the bundling of data with the methods (or other functions) operating on that data.[</li>
						</ul>
						<em>--Wikipedia definition</em>
					</section>
					<section>
						<h2>Questions about Encapsulation?</h2>
					</section>
				</section>

				<section>
					<h2>Similar Data, Different Model?</h2>
					<ul>
						<li class="fragment">Create a bundle.</li>
						<li class="fragment">Create another entity.</li>
					</ul>
					<aside class="notes">
						<ul>
							<li>How do you deal with similar data the needs different fields?</li>
							<li>Lets talk about creating another entity first.</li>
						</ul>
					</aside>
				</section>

				<section>
					<section>
						<h2>Using a Base Class</h2>
						<pre><code data-trim contenteditable>
class TourneyEntity extends Entity {
  ...
  public function save() {
    if ((isset($this->is_new) && $this->is_new) || $this->created == 0) {
      $this->created = time();
    }
    $this->changed = time();
    parent::save();
  }

  /**
   * Return the uri to the entity object
   */
  public function getUri() {
    return TourneyEntity::path($this->id, $this->entityType);
  }
  ...
}
						</code></pre>
						<aside class="notes">
							This slide has fragments which are also stepped through in the notes window.
						</aside>
					</section>

					<section>
						<h1>Inheritance</h1>
						<p>Super powerful!</p>
						<aside class="notes">
							<ul>
								<li>How do you deal with similar data the needs different fields?</li>
								<li>Lets talk about creating another entity first.</li>
							</ul>
						</aside>
					</section>
					<section>
						<h1>Writing Views Handlers</h1>
						<p>Next session in Room G7</p>
						<aside class="notes">
							<ul>
								<li>As a side note, if you come to my next session in the next hour I'll be talking about extending the Views module and writing your own handlers... and this is exactly how you do it.... using Inheritance.</li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Questions about Inheritance?</h2>
					</section>
				</section>

				<section>
					<section>
						<h1>Using Bundles</h1>
						<ul>
							<li class="fragment">All bundles share the same entity class</li>
							<li class="fragment">How can I get a specific class per bundle?</li>
						</ul>
					</section>
					<section>
						<h1>Proxy Pattern</h1>
						<a href="https://sourcemaking.com/design_patterns/proxy">https://sourcemaking.com/design_patterns/proxy</a>
						<img src="img/Proxy1-2x.png" alt="" class="no-border" style="width:60%">
					</section>
					<section>
						<h2>Define your Entity with the Proxy</h2>
						<pre><code data-trim contenteditable>
/**
 * Implements hook_entity_info().
 */
function it_service_entity_info() {
  $info = array(
    'it_service' => array(
      'label' => t('IT Service'),
      'plural label' => t('IT Services'),
      'description' => t('A single service provided by IT Services.'),
      'entity class' => 'Drupal\it_service\Entity\ItServiceProxy',
      'controller class' => 'EntityAPIController',
      'base table' => 'it_service',
      'fieldable' => TRUE,
      ...
    )
  );
  return $info;
}
						</code></pre>
					</section>
					<section>
						<h2>Proxy Class</h2>
						<pre><code data-trim contenteditable>
namespace Drupal\it_service\Entity;
...
class ItServiceProxy extends ItServiceBase {

  protected $entityClass;
  protected $entityType = 'it_service';

  /**
   * ItServiceProxy constructor.
   */
  public function __construct(array $values, $entityType) {
    $values['type'] = !empty($this->type) ? $this->type : $values['type'];
    $this->type = $values['type'];
    if (is_null($this->entityClass)) {
      $this->makeEntity($values['type']);
    }
  }

  private function makeEntity($bundle) {
    $className = 'Drupal\it_service\Entity\\' . CaseConverter::toCamelCase($bundle);
    if (class_exists($className)) {
      $this->entityClass = new $className(['type' => $bundle], $this->entityType);
    }
    else {
      throw new \Exception(t('A class does not exist for @bundleName bundle.', ['@bundleName' => $className]));
    }
  }

  function __call($name, $args) {
    if (!method_exists($this->entityClass, $name)) return FALSE;

    $method = new \ReflectionMethod($this->entityClass, $name);
    return $method->invoke($this->entityClass, $args);
  }

}
						</code></pre>
					</section>
					<section>
						<h1>Polymorphism in Drupal!</h1>
					</section>
				</section>

				<section>
					<section>
						<h1>Bonus</h1>
						<h2>Show me how to create an entity!</h2>
					</section>
					<section data-background-video="img/newentity.mp4"></section>
					<section>
						<h2>It's on GitHub!</h2>
						<a href="https://github.com/activelamp/generator-entityD7">https://github.com/activelamp/generator-entityD7</a>
					</section>
				</section>



				<section>
					<h2>Subscribe to our YouTube Channel</h2>
					<p>http://youtube.com/activelamp</p>
					<img src="img/activelamp-youtube.jpg" class="no-border" style="width: 65%"/>

					<aside class="notes">
						<ul>
							<li>Thanks for coming to this session</li>
							<li>Please go to our YouTube channel and subscribe, and share our channel.  We're going to be releasing this session as well as other great content over there.</li>
						</ul>
					</aside>
				</section>

				<section style="text-align: left;"  data-background-video="img/Website-Loop.mov" data-background-video-loop>
					<div style="width: 60%; float: left">
						<h1>Questions?</h1>
						<p>Send me an email:</p>
						<em>tom@activelamp.com</em>
						<br /><br />
						<em>or in IRC #drupal-la</em>
					</div>
					<div style="width: 40%; float: left">
						<img src="img/activelamp_square_logo.png" style="border: none; box-shadow: none" />
					</div>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
